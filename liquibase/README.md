# For Developers only

## Scripts

### run-liquibase.sh
This script executes liquibase update/rollback/updateSQL/rollbackSQL.

```
Usage: ./liquibase/run-liquibase.sh --database <database name> [Other Options]
        --database, -d          Database name
Other Options:
        --host, -H              Database host (default: localhost)
        --port, -P              Database port (default: 3306)
        --user, -u              Database user (default: root)
        --password, -p          Database password (default: 123456)
        --docker-network, -n    Docker network name (default: host)
        --rollback, -R          Rollback a changeset using a tag
        --sql, -S               Print SQL Only
```

### generate-sql.sh
This script generates Update and Rollback SQL Scripts into a file given a rollback tag.

```
Usage: ./liquibase/generate-sql.sh --changelog <JIRA ticket or rollback tag name> [Other Options]
Other Options:
        --database, -d          Database name
        --rollback, -R          Rollback flag
```

## Liquibase Folder Structure
Liquibase-related stuff are inside liquibase folder of the project folder.
The following are the contents of the liquibase folder

1. changelogs - a folder that contains the particular changelog xml for a particular feature or JIRA ticket.
The format of the file should be: `{lowercase ticket no.}-xml`. Example: dev-13141.xml
2. sql - a folder that contains the generated SQL files generated by generate-sql.sh
3. changelog.xml - the main changelog xml which contains reference to all changelogs.
If you have created a new changelog file inside changelogs folder, you have to include the feature-base changelog inside
this xml.
4. generate-sql.sh - script for generating SQL scripts for the current JIRA ticket you are working
5. mysql.yml - docker-compose file to run a mysql server on a Docker container
6. run-liquibase.sh - script to execute liquibase update/rollback/updateSQL/rollbackSQL

## Steps when creating Database Updates

1. Create changelog file for JIRA ticket under changelogs folder. 
The format of the file should be: `{lowercase ticket no.}-xml`. Example: dev-13141.xml
2. Add reference to the newly created changelog to the changelog.xml
3. Execute `./liquibase/generate-sql.sh -cl {ticket no.}` to generate Update SQL file update ./liquibase/sql folder.
4. Execute `./liquibase/generate-sql.sh -cl {ticket no.} -R` to generate Rollback SQL file update ./liquibase/sql folder.
5. Create DBC ticket and write the contents of update and rollback SQL files to the ticket.
6. `git add ./liquibase` to add generated SQL files to staged files for commit.
7. Commit all changes under liquibase folder including SQL files and XML files.
